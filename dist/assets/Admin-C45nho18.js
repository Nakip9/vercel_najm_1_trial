import{j as e}from"./motion-C26BWbv8.js";import{r as d}from"./vendor-BFLsp65Y.js";const E=({onSuccess:c})=>{const[a,h]=d.useState({passport_number:"",first_name:"",last_name:"",status:"pending",admin_notes:""}),[t,m]=d.useState(!1),[i,o]=d.useState(null),p=async n=>{if(n.preventDefault(),o(null),!a.passport_number.trim()){o("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø² Ù…Ø·Ù„ÙˆØ¨");return}m(!0);try{const u=await fetch("/api/admin/create-entry",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({passport_number:a.passport_number.trim().toUpperCase(),first_name:a.first_name.trim(),last_name:a.last_name.trim(),status:a.status,admin_notes:a.admin_notes.trim()||null})}),s=await u.json();if(!u.ok){o(s.error||"ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø®Ù„");return}h({passport_number:"",first_name:"",last_name:"",status:"pending",admin_notes:""}),alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø®Ù„ Ø¨Ù†Ø¬Ø§Ø­!"),c()}catch(u){console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø®Ù„:",u),o("Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")}finally{m(!1)}};return e.jsxs("div",{className:"add-entry-form",children:[e.jsx("h3",{children:"Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø®Ù„ Ø¬Ø¯ÙŠØ¯ Ù„Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±"}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"passport-number",children:"Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø² *"}),e.jsx("input",{type:"text",id:"passport-number",value:a.passport_number,onChange:n=>h({...a,passport_number:n.target.value}),placeholder:"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²",required:!0,disabled:t})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"first-name",children:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„"}),e.jsx("input",{type:"text",id:"first-name",value:a.first_name,onChange:n=>h({...a,first_name:n.target.value}),placeholder:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„",disabled:t})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"last-name",children:"Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©"}),e.jsx("input",{type:"text",id:"last-name",value:a.last_name,onChange:n=>h({...a,last_name:n.target.value}),placeholder:"Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©",disabled:t})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Ø§Ù„Ø­Ø§Ù„Ø© *"}),e.jsxs("select",{id:"status",value:a.status,onChange:n=>h({...a,status:n.target.value}),required:!0,disabled:t,children:[e.jsx("option",{value:"pending",children:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"}),e.jsx("option",{value:"in_embassy",children:"ÙÙŠ Ø§Ù„Ø³ÙØ§Ø±Ø©"}),e.jsx("option",{value:"ready",children:"Ø¬Ø§Ù‡Ø²"}),e.jsx("option",{value:"rejected",children:"Ù…Ø±ÙÙˆØ¶"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"admin-notes",children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsx("textarea",{id:"admin-notes",value:a.admin_notes,onChange:n=>h({...a,admin_notes:n.target.value}),placeholder:"Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¯Ø®Ù„...",rows:"3",disabled:t})]}),i&&e.jsx("div",{className:"error-message",children:i}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:t,children:t?"Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø¶Ø§ÙØ©...":"Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø®Ù„"})]})]})},F=({entry:c,onClose:a,onSuccess:h})=>{const[t,m]=d.useState({first_name:c.first_name||"",last_name:c.last_name||"",status:c.status,admin_notes:c.admin_notes||""}),[i,o]=d.useState(!1),[p,n]=d.useState(null);d.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const u=async r=>{r.preventDefault(),n(null),o(!0);try{const l=await fetch("/api/admin/update-status",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c.id,first_name:t.first_name.trim(),last_name:t.last_name.trim(),status:t.status,admin_notes:t.admin_notes.trim()||null})}),x=await l.json();if(!l.ok){n(x.error||"Failed to update entry");return}alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!"),h()}catch(l){console.error("Error updating entry:",l),n("Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")}finally{o(!1)}},s=r=>{r.target===r.currentTarget&&a()};return e.jsx("div",{className:"modal-backdrop",onClick:s,children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"}),e.jsx("button",{className:"modal-close",onClick:a,children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"entry-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²:"})," ",c.passport_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:"})," ",new Date(c.created_at).toLocaleString("ar-SA")]})]}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"form-group-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-first-name",children:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„"}),e.jsx("input",{type:"text",id:"edit-first-name",value:t.first_name,onChange:r=>m({...t,first_name:r.target.value}),placeholder:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„",disabled:i})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-last-name",children:"Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©"}),e.jsx("input",{type:"text",id:"edit-last-name",value:t.last_name,onChange:r=>m({...t,last_name:r.target.value}),placeholder:"Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©",disabled:i})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-status",children:"Ø§Ù„Ø­Ø§Ù„Ø© *"}),e.jsxs("select",{id:"edit-status",value:t.status,onChange:r=>m({...t,status:r.target.value}),required:!0,disabled:i,children:[e.jsx("option",{value:"pending",children:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"}),e.jsx("option",{value:"in_embassy",children:"ÙÙŠ Ø§Ù„Ø³ÙØ§Ø±Ø©"}),e.jsx("option",{value:"ready",children:"Ø¬Ø§Ù‡Ø²"}),e.jsx("option",{value:"rejected",children:"Ù…Ø±ÙÙˆØ¶"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-notes",children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsx("textarea",{id:"edit-notes",value:t.admin_notes,onChange:r=>m({...t,admin_notes:r.target.value}),placeholder:"Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¯Ø®Ù„...",rows:"4",disabled:i})]}),p&&e.jsx("div",{className:"error-message",children:p}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:a,disabled:i,children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:i,children:i?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...":"ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"})]})]})]})]})})},D=({entries:c,onRefresh:a,onDelete:h})=>{const[t,m]=d.useState(null),[i,o]=d.useState(null),p=s=>{m(s)},n=async(s,r)=>{if(window.confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø² ${r}ØŸ`)){o(s);try{const l=await fetch(`/api/admin/delete-entry?id=${s}`,{method:"DELETE"}),x=await l.json();if(!l.ok){alert(x.error||"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø¯Ø®Ù„");return}alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¯Ø®Ù„ Ø¨Ù†Ø¬Ø§Ø­"),a()}catch(l){console.error("Error deleting entry:",l),alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø¯Ø®Ù„")}finally{o(null)}}},u=s=>{const r={ready:{label:"Ø¬Ø§Ù‡Ø²",className:"badge-success"},in_embassy:{label:"ÙÙŠ Ø§Ù„Ø³ÙØ§Ø±Ø©",className:"badge-warning"},pending:{label:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",className:"badge-info"},rejected:{label:"Ù…Ø±ÙÙˆØ¶",className:"badge-error"}},l=r[s]||r.pending;return e.jsx("span",{className:`status-badge ${l.className}`,children:l.label})};return c.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±. Ø£Ø¶Ù Ø£ÙˆÙ„ Ø¥Ø¯Ø®Ø§Ù„ Ù„Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"passport-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²"}),e.jsx("th",{children:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"}),e.jsx("th",{children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsx("th",{children:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"}),e.jsx("th",{children:"Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«"}),e.jsx("th",{children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª"}),e.jsx("th",{children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:s.passport_number})}),e.jsx("td",{children:[s.first_name,s.last_name].filter(Boolean).join(" ")||"â€”"}),e.jsx("td",{children:u(s.status)}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{children:new Date(s.updated_at).toLocaleDateString()}),e.jsx("td",{className:"notes-cell",children:s.admin_notes?e.jsx("span",{title:s.admin_notes,children:s.admin_notes.length>30?`${s.admin_notes.substring(0,30)}...`:s.admin_notes}):e.jsx("span",{className:"text-muted",children:"â€”"})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-edit",onClick:()=>p(s),title:"ØªØ¹Ø¯ÙŠÙ„",children:"âœï¸ ØªØ¹Ø¯ÙŠÙ„"}),e.jsx("button",{className:"btn-delete",onClick:()=>n(s.id,s.passport_number),disabled:i===s.id,title:"Ø­Ø°Ù",children:i===s.id?"â³":"ðŸ—‘ï¸ Ø­Ø°Ù"})]})})]},s.id))})]})}),t&&e.jsx(F,{entry:t,onClose:()=>m(null),onSuccess:()=>{m(null),a()}})]})},T=()=>{const[c,a]=d.useState([]),[h,t]=d.useState(!0),[m,i]=d.useState(null),[o,p]=d.useState(""),[n,u]=d.useState("all"),[s,r]=d.useState(1),[l,x]=d.useState(null),v=async(j=1,N="",S="all")=>{t(!0),i(null);try{const g=new URLSearchParams({page:j.toString(),limit:"50"});N.trim()&&g.append("search",N.trim()),S!=="all"&&g.append("status",S);const y=await fetch(`/api/admin/list-entries?${g.toString()}`),f=await y.json();if(!y.ok){i(f.error||"ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");return}a(f.data||[]),x(f.pagination)}catch(g){console.error("Error fetching entries:",g),i("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")}finally{t(!1)}};d.useEffect(()=>{v(s,o,n)},[s,o,n]);const b=()=>{v(s,o,n)},C=j=>{p(j.target.value),r(1)},w=j=>{u(j.target.value),r(1)},_=j=>{r(j),window.scrollTo({top:0,behavior:"smooth"})};return e.jsx("div",{className:"admin-page",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„ÙÙŠØ²Ø§"}),e.jsx("p",{children:"Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¯Ø®Ù„Ø§Øª Ø¬ÙˆØ§Ø²Ø§Øª Ø§Ù„Ø³ÙØ± ÙˆØ­Ø§Ù„Ø§Øª Ø§Ù„ÙÙŠØ²Ø§"})]}),e.jsxs("div",{className:"admin-content",children:[e.jsx(E,{onSuccess:b}),e.jsxs("div",{className:"admin-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"search",children:"Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¬ÙˆØ§Ø²"}),e.jsx("input",{type:"text",id:"search",placeholder:"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²...",value:o,onChange:C})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"status-filter",children:"ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ù‡"}),e.jsxs("select",{id:"status-filter",value:n,onChange:w,children:[e.jsx("option",{value:"all",children:"Ø§Ù„ÙƒÙ„"}),e.jsx("option",{value:"pending",children:"ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"}),e.jsx("option",{value:"in_embassy",children:"ÙÙŠ Ø§Ù„Ø³ÙØ§Ø±Ø©"}),e.jsx("option",{value:"ready",children:"Ø¬Ø§Ù‡Ø²"}),e.jsx("option",{value:"rejected",children:"Ù…Ø±ÙÙˆØ¶"})]})]})]}),m&&e.jsxs("div",{className:"error-banner",children:[m,e.jsx("button",{onClick:b,children:"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"})]}),h?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner-large"}),e.jsx("p",{children:"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{entries:c,onRefresh:b,onDelete:b}),l&&l.totalPages>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn-pagination",onClick:()=>_(s-1),disabled:s===1,children:"Ø§Ù„Ø³Ø§Ø¨Ù‚"}),e.jsxs("span",{className:"pagination-info",children:["ØµÙØ­Ø© ",l.page," Ù…Ù† ",l.totalPages," (Ø§Ù„ÙƒÙ„ ",l.total,")"]}),e.jsx("button",{className:"btn-pagination",onClick:()=>_(s+1),disabled:s===l.totalPages,children:"Ø§Ù„ØªØ§Ù„ÙŠ"})]})]})]})]})})};export{T as default};
